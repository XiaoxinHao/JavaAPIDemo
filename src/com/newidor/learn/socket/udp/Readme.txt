代码来源：
1、http://blog.csdn.net/wintys/article/details/3525643/
并M行了部分改造